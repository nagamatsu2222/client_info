<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>顧客情報管理システムへの各機能追加</title>
    <style>
      table{
        border-collapse:  collapse;
        margin: 0 auto;
        width: 90%;
      }
      th{
        background-color: #ddf5ef;
      }
      th,td{
        padding: 1.5% 0;
        border: 1px solid;
        font-size:small;
        text-align: center;
      }
      .border{
        border: 1px solid;
      }
      .search_wrap{
        margin: 0 auto;
        width: 90%;
        text-align: right;
      }
      input.search {
        -webkit-appearance: none;
        display: inline-block;
        margin-right: 0;
        margin-bottom: 20px;
        padding: 10px;
        width: 200px;
        height: 40px;
        font-size: 100%;
        box-sizing: border-box;
        border-radius: 5px;
        border: 1px solid #ccc;
      }
      input.search_btn{
        -webkit-appearance: none;
        display: inline-block;
        padding: 0 10px;
        color: #fff;
        height: 40px;
        font-size: 100%;
        vertical-align: top;
        border: none;
        border-radius: 5px;
        background: #1f76e2;
      }
      .select_wrap{
        margin: 40px 0 40px;
      }
      .statBtn{
        -webkit-appearance: none;
        display: inline-block;
        padding: 0 10px;
        color: #fff;
        height: 40px;
        font-size: 100%;
        vertical-align: top;
        border: none;
        border-radius: 5px;
        background: #ee9917;
        margin: 2% 0 5%;;
      }
      .stat_wrap{
        margin: 0 auto;
        width: 90%;
        text-align: center;
      }
    </style>
</head>
<body>
    <div class="search_wrap">
      <input type="search" placeholder="検索" id="nameSearch" class="search" value="">
      <input type="submit" value="送信" id="nameSearchBtn" class="search_btn" onclick="searchBtn()">
    </div>
    <div class="stat_wrap"><input type="button" value="統計ボタン" class="statBtn">
      <div class="statList"></div>
    </div>
    <table class="border usersBox">
      <thead>
        <tr>
          <th>id</th>
          <th>名前</th>
          <th>ふりがな</th>
          <th>性別</th>
          <th>メールアドレス</th>
          <th>電話番号</th>
          <th>住所</th>
          <th>都道府県</th>
          <th>世帯数</th>
          <th>追加</th>
        </tr>
      </thead>
      <tbody class="usersBoxInfo">
        <% for (let i = 0; i < users.length; i++) { %>
        <tr>
          <td><%= users[i].id %></td>
          <td><%= users[i].name %></td>
          <td><%= users[i].kana_name %></td>
          <td><%= users[i].gender %></td>
          <td><%= users[i].email %></td>
          <td><%= users[i].phone %></td>
          <td><%= users[i].address %></td>
          <td><%= users[i].workplace %></td>
          <td><%= users[i].household %></td>
          <td><input type="button" value="選択" class="usersSelectBtn"></td>
        </tr>
        <% } %>
      </tbody>
    </table>
    <div class="select_wrap">
      <table class="selectUsers"></table>
    </div>
    <!-- ここからjsの記述 -->
    <script type="text/javascript">

        // 課題01 - 情報の絞り込み機能
        let users = JSON.parse('<%= JSON.stringify(users) %>'.replace(/&#34;/g, '"'));
        let user_list_box = document.getElementById('user_list_box');
        let nameSearch = document.getElementById('nameSearch');
        let nameSearchBtn = document.getElementById('nameSearchBtn');
        let usersBox = document.getElementsByClassName("usersBox");
        let usersBoxInfo = document.getElementsByClassName("usersBoxInfo");
        let nameList = [];
        // 検索フォームの送信ボタンをクリック
        function searchBtn(){
          for (let i = 0; i < users.length; i++) {
            if(nameSearch === ""){
            }else{
              // 一覧表削除
              while(usersBoxInfo[0].firstChild){
                usersBoxInfo[0].removeChild(usersBoxInfo[0].firstChild);
              }
              // 検索結果を出力する
              if(users[i].name.indexOf(nameSearch.value)!== -1){
                nameList.push(users[i]);
                console.log(nameList)
                usersBox[0].insertAdjacentHTML("beforeend",`<tr><td>${users[i].id}</td><td>${users[i].name}</td><td>${users[i].kana_name}</td><td>${users[i].gender}</td><td>${users[i].email}</td><td>${users[i].phone}</td><td>${users[i].address}</td><td>${users[i].workplace}</td><td>${users[i].household}</td></tr>`)
              }
            }
          }
        }

        // 課題02 - 情報を格納する機能
        const usersSelectBtn = document.getElementsByClassName("usersSelectBtn");
        const selectUsers = document.getElementsByClassName("selectUsers");

        // 選択ボタンをクリックしたら削除
        function btnClick(event){
          event.currentTarget.parentNode.parentNode.remove();
        }
        usersSelectBtn[0].addEventListener('click', btnClick);

        for (let i = 0; i < users.length; i++) {
          usersSelectBtn[i].addEventListener('click',function(){
            event.currentTarget.parentNode.parentNode.remove();
            // 選択ボタンをクリックしたら選択した要素が増える
            if(event.currentTarget.parentNode.parentNode.firstElementChild = users[i].id){
              nameList.push(users[i]);
              selectUsers[0].insertAdjacentHTML("beforeend",`<tr><td>${users[i].id}</td><td>${users[i].name}</td><td>${users[i].kana_name}</td><td>${users[i].gender}</td><td>${users[i].email}</td><td>${users[i].phone}</td><td>${users[i].address}</td><td>${users[i].workplace}</td><td>${users[i].household}</td></tr>`)
            };
          },false);
        }

        // 課題03 - 各項目の内容を統計する機能
        const statBtn = document.getElementsByClassName("statBtn");
        // 統計ボタンをクリックしたら
        statBtn[0].addEventListener('click', function() {
          console.log('クリックされました！');
          for (let i = 0; i < users.length; i++){
            // if(users[i].gender.length === '女性'){
            // }
            const MEN = (users[i].gender.match(/男性/g) || []).length;
            const WMN = (users[i].gender.match(/女性/g) || []).length;
            console.log(MEN);
          }return;

        }, false);

    </script>
</body>
</html>